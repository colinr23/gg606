<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 2 Wrangling | Scientific Data Wrangling</title>
  <meta name="description" content="This course covers the data science skills comprising data visualization, data wrangling (cleaning, combining, modelling, etc.), and methodological and statistical design, which are an important part of the scientific method." />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 2 Wrangling | Scientific Data Wrangling" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This course covers the data science skills comprising data visualization, data wrangling (cleaning, combining, modelling, etc.), and methodological and statistical design, which are an important part of the scientific method." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 2 Wrangling | Scientific Data Wrangling" />
  
  <meta name="twitter:description" content="This course covers the data science skills comprising data visualization, data wrangling (cleaning, combining, modelling, etc.), and methodological and statistical design, which are an important part of the scientific method." />
  

<meta name="author" content="Colin Robertson" />


<meta name="date" content="2022-03-03" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="practice.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">GG606</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#textbooks"><i class="fa fa-check"></i><b>1.1</b> Textbooks</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#cheatsheets"><i class="fa fa-check"></i><b>1.2</b> Cheatsheets</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#additional-readings"><i class="fa fa-check"></i><b>1.3</b> Additional Readings</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#schedule"><i class="fa fa-check"></i><b>1.4</b> Schedule</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#evaluation"><i class="fa fa-check"></i><b>1.5</b> Evaluation</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#grading"><i class="fa fa-check"></i><b>1.5.1</b> Grading</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Wrangling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="intro.html"><a href="intro.html#data-science-workflows"><i class="fa fa-check"></i><b>2.1</b> Data Science Workflows</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="intro.html"><a href="intro.html#wrangling-intro-reading"><i class="fa fa-check"></i><b>2.1.1</b> Reading</a></li>
<li class="chapter" data-level="2.1.2" data-path="intro.html"><a href="intro.html#excercise-review"><i class="fa fa-check"></i><b>2.1.2</b> Excercise Review</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="intro.html"><a href="intro.html#io"><i class="fa fa-check"></i><b>2.2</b> i/o</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="intro.html"><a href="intro.html#wrangling-io"><i class="fa fa-check"></i><b>2.2.1</b> Reading</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="intro.html"><a href="intro.html#data-objects"><i class="fa fa-check"></i><b>2.3</b> Data objects</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="intro.html"><a href="intro.html#data-object-reading"><i class="fa fa-check"></i><b>2.3.1</b> Reading</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="intro.html"><a href="intro.html#databases"><i class="fa fa-check"></i><b>2.4</b> Databases</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="intro.html"><a href="intro.html#db-resources"><i class="fa fa-check"></i><b>2.4.1</b> Resources</a></li>
</ul></li>
<li class="chapter" data-level="2.5" data-path="intro.html"><a href="intro.html#spatial-data"><i class="fa fa-check"></i><b>2.5</b> Spatial data</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="intro.html"><a href="intro.html#spatial-readings1"><i class="fa fa-check"></i><b>2.5.1</b> Reading</a></li>
</ul></li>
<li class="chapter" data-level="2.6" data-path="intro.html"><a href="intro.html#temporal-data"><i class="fa fa-check"></i><b>2.6</b> Temporal data</a>
<ul>
<li class="chapter" data-level="2.6.1" data-path="intro.html"><a href="intro.html#space-time-data---stars-package-exploration"><i class="fa fa-check"></i><b>2.6.1</b> Space-time data - STARS package exploration</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="practice.html"><a href="practice.html"><i class="fa fa-check"></i><b>3</b> Practice</a></li>
<li class="chapter" data-level="4" data-path="assignments.html"><a href="assignments.html"><i class="fa fa-check"></i><b>4</b> Assignments</a>
<ul>
<li class="chapter" data-level="4.1" data-path="assignments.html"><a href="assignments.html#assignment-1---importing-parsing-and-querying-data-in-the-wild"><i class="fa fa-check"></i><b>4.1</b> Assignment 1 - Importing, parsing, and querying data in the wild</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="assignments.html"><a href="assignments.html#dataset"><i class="fa fa-check"></i><b>4.1.1</b> Dataset</a></li>
<li class="chapter" data-level="4.1.2" data-path="assignments.html"><a href="assignments.html#questions"><i class="fa fa-check"></i><b>4.1.2</b> Questions</a></li>
<li class="chapter" data-level="4.1.3" data-path="assignments.html"><a href="assignments.html#submission"><i class="fa fa-check"></i><b>4.1.3</b> Submission</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="assignments.html"><a href="assignments.html#assignment-2---real-world-data-wrangling"><i class="fa fa-check"></i><b>4.2</b> Assignment 2 - Real world data wrangling</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="term-project---analytics-studio-demo.html"><a href="term-project---analytics-studio-demo.html"><i class="fa fa-check"></i><b>5</b> Term Project - Analytics Studio Demo</a>
<ul>
<li class="chapter" data-level="5.1" data-path="term-project---analytics-studio-demo.html"><a href="term-project---analytics-studio-demo.html#overview"><i class="fa fa-check"></i><b>5.1</b> Overview</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="term-project---analytics-studio-demo.html"><a href="term-project---analytics-studio-demo.html#demonstration"><i class="fa fa-check"></i><b>5.1.1</b> Demonstration</a></li>
<li class="chapter" data-level="5.1.2" data-path="term-project---analytics-studio-demo.html"><a href="term-project---analytics-studio-demo.html#critique"><i class="fa fa-check"></i><b>5.1.2</b> Critique</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="term-project---analytics-studio-demo.html"><a href="term-project---analytics-studio-demo.html#submission-1"><i class="fa fa-check"></i><b>5.2</b> Submission</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Scientific Data Wrangling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="intro" class="section level1" number="2">
<h1><span class="header-section-number">Chapter 2</span> Wrangling</h1>
<div id="data-science-workflows" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Data Science Workflows</h2>
<div id="wrangling-intro-reading" class="section level3" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Reading</h3>
<p>This week will provide an introduction to data science using <code>r</code>. You will be introduced to data science through the lens of exploratory data analysis, beginning with the <strong>Explore</strong> section of the textbook, read and work through the following chapters:</p>
<ul>
<li><a href="https://r4ds.had.co.nz/explore-intro.html">W&amp;G - Introduction</a></li>
<li><a href="https://r4ds.had.co.nz/data-visualisation.html">W&amp;G - Data visualization</a></li>
<li><a href="https://r4ds.had.co.nz/transform.html">W&amp;G - Data Transformation</a></li>
<li><a href="https://r4ds.had.co.nz/workflow-basics.html">W&amp;G - Workflow: basics</a></li>
<li><a href="https://r4ds.had.co.nz/workflow-scripts.html">W&amp;G - Workflow: scripts</a></li>
<li><a href="https://r4ds.had.co.nz/workflow-projects.html">W&amp;G - Workflow: projects</a></li>
</ul>
</div>
<div id="excercise-review" class="section level3" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Excercise Review</h3>
<ul>
<li>Data Visualization: <a href="https://r4ds.had.co.nz/data-visualisation.html#exercises-1">1</a>, <a href="https://r4ds.had.co.nz/data-visualisation.html#exercises-2">2</a>, <a href="https://r4ds.had.co.nz/data-visualisation.html#exercises-3">3</a>, <a href="https://r4ds.had.co.nz/data-visualisation.html#exercises-4">4</a>, <a href="https://r4ds.had.co.nz/data-visualisation.html#exercises-5">5</a>, <a href="https://r4ds.had.co.nz/data-visualisation.html#exercises-6">6</a></li>
<li>Workflow: basics: <a href="https://r4ds.had.co.nz/workflow-basics.html#exercises-7">1</a></li>
</ul>
</div>
</div>
<div id="io" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> i/o</h2>
<div id="wrangling-io" class="section level3" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Reading</h3>
<p>This week will cover the surprisingly important topic of data i/o - that is, data <em>importing</em> and <em>outputting</em> data. In the <strong>Wrangle</strong> section of the textbook, read and work through the following chapters:</p>
<ul>
<li><a href="https://jhudatascience.org/tidyversecourse/get-data.html">JHDSc - Data import</a></li>
<li><a href="https://r4ds.had.co.nz/tidy-data.html">W&amp;G - Tidy data</a>
<ul>
<li><a href="https://www.jstatsoft.org/article/view/v059i10">As well as the paper</a> describing the <code>tidy</code> approach to data, published in the Journal of Statistical Software.</li>
</ul></li>
<li><a href="https://cran.r-project.org/doc/manuals/r-release/R-data.html">R documentation - Review of Data Import/Export</a></li>
</ul>
<p>Data sources and formats vary widely in environmental data analytics. <em>Data acquisition</em> is the steps taken to access and load data for your own analysis. In a classic analysis workflow architecture, data are downloaded to a local working computer and interact with software installed there to complete your analysis.</p>
<p>Raw data almost always has to be processed in different ways to make it useful. This can in include Quality Assurance/Quality Control (QA/QC) steps such as checking and removing duplicate records, cleaning out special characters from text, to things like date formatting and computing derived variables. Having a consistent way to generate data transformations is a cornerstone of reproducible research and modern scientific data workflows. This is one of the key reasons scripting has become so important to environmental data analytics.</p>
<p>The <code>tidy</code> approach to data science aims to provide a cohesive and consistent approach to data organization in <code>r</code>.</p>
</div>
</div>
<div id="data-objects" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Data objects</h2>
<div id="data-object-reading" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Reading</h3>
<p>We will cover some more basic elements of the R programming language - both at the base and more modern levels. At some point having an understanding of how <code>R</code> works at a deeper level becomes necessary to get the most out of it and develop effective analysis and visualization approaches.</p>
<ul>
<li><a href="https://adv-r.hadley.nz/vectors-chap.html">Wickham - Vectors</a></li>
<li><a href="https://ubc-dsci.github.io/introduction-to-datascience/wrangling.html">TCL - Wrangling</a></li>
</ul>
</div>
</div>
<div id="databases" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Databases</h2>
<div id="db-resources" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Resources</h3>
<p>There are no dedicated readings this week, but below are some of the resources discussed during class this week.</p>
<ul>
<li><a href="https://db.rstudio.com/getting-started/database-queries">R-studio docs</a></li>
<li><a href="https://thespatiallabatlaurier.github.io/nzdggs/Examples/GettingStarted/">Examples of lazy execution</a></li>
</ul>
</div>
</div>
<div id="spatial-data" class="section level2" number="2.5">
<h2><span class="header-section-number">2.5</span> Spatial data</h2>
<p>Spatial data wrangling encompasses a set of techniques usually found in standard GIS courses. Tasks such as spatial query, spatial overlay, combining vector and raster data, are all often necessary steps in preparing spatial data for analysis. Due to the mature collection of packages for working with spatial data n <code>r</code>, all of these operations can be performed in <code>r</code>, generally through a <code>tidy</code> workflow.</p>
<div id="spatial-readings1" class="section level3" number="2.5.1">
<h3><span class="header-section-number">2.5.1</span> Reading</h3>
<ul>
<li><a href="https://colinr23.github.io/gg501/lecs/gg501-W4.pdf">501 Lecture slides for review</a></li>
<li><a href="https://journal.r-project.org/archive/2018/RJ-2018-009/RJ-2018-009.pdf">Pebezma 2018</a></li>
<li><a href="https://keen-swartz-3146c4.netlify.app/geometries.html">Pebezma - geom</a></li>
<li><a href="https://keen-swartz-3146c4.netlify.app/sf.html">Pebezma - sf</a></li>
<li><a href="https://mgimond.github.io/Spatial/reading-and-writing-spatial-data-in-r.html#app1_2">Gimond Appendix- Walk-thru of common spatial operations</a></li>
</ul>
<!---#### Point in polygon counts
Data: [point event crime in waterloo](https://www.wrps.on.ca/en/about-us/reports-publications-and-surveys.aspx), [polygon census units in waterloo](https://www12.statcan.gc.ca/census-recensement/2011/geo/bound-limit/bound-limit-2016-eng.cfm)
Task: for a given type of crime, subset and count occurences within each census unit
Operation: Spatial query/subsetting

Read data in:


```
## [1] TRUE
```

```
## Reading layer `lct_000b16a_e' from data source 
##   `/Users/colinr23/Dropbox/course/g606/tec/gg606/data/lct_000b16a_e.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 5721 features and 8 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: 3912489 ymin: 693729 xmax: 8996156 ymax: 2810986
## Projected CRS: PCS_Lambert_Conformal_Conic
```

<img src="GG606_files/figure-html/unnamed-chunk-1-1.png" width="672" />

The [Region of Waterloo](https://rowopendata-rmw.opendata.arcgis.com/datasets/KitchenerGIS::park-natural-area-ecological-land-classification/explore?location=43.442066%2C-80.480368%2C12.00&showTable=true) has an open data we can access some other datasets from:

We now have `ct` which is an `sf` class which represents census tracts in the Waterloo area.

#### Read in our three spatial data files 

```
## Reading layer `Trails' from data source 
##   `/Users/colinr23/Dropbox/course/g606/tec/gg606/data/Trails/Trails.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 1633 features and 28 fields
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: -80.81168 ymin: 43.26102 xmax: -80.27309 ymax: 43.65101
## Geodetic CRS:  WGS 84
```

```
## Reading layer `Park_Natural_Area_Ecological_Land_Classification' from data source `/Users/colinr23/Dropbox/course/g606/tec/gg606/data/Park_Natural_Area_Ecological_Land_Classification/Park_Natural_Area_Ecological_Land_Classification.shp' 
##   using driver `ESRI Shapefile'
## Simple feature collection with 625 features and 12 fields
## Geometry type: MULTIPOLYGON
## Dimension:     XY
## Bounding box:  xmin: -80.55806 ymin: 43.37734 xmax: -80.40301 ymax: 43.50665
## Geodetic CRS:  WGS 84
```

```
## [1] "PCS_Lambert_Conformal_Conic"
```

```
## [1] "+proj=lcc +lat_0=63.390675 +lon_0=-91.8666666666667 +lat_1=49 +lat_2=77 +x_0=6200000 +y_0=3000000 +datum=NAD83 +units=m +no_defs"
```

```
## [1] "WGS 84"
```

```
## [1] "+proj=longlat +datum=WGS84 +no_defs"
```

```
## [1] "WGS 84"
```

```
## [1] "+proj=longlat +datum=WGS84 +no_defs"
```

```
## [1] 4326
```

<img src="GG606_files/figure-html/unnamed-chunk-2-1.png" width="672" />

Here we can make some further observations of our data. 

1. Our reprojection worked as the dare plotting correctly
2. The trails layer exceeds the boundaries of the `ct` layer
3. There are no `eco` polygons in the outer areas of the `ct`s 

We can clip the `trails` layer to the bounds of the `ct` layer. It might be useful to generate a study area polygon based on the union of the polygons in `ct`. We saw last week we can do this using `dplyr` syntax for grouping


```r
studyArea <- ct %>% 
  group_by() %>% 
  summarise()
plot(st_geometry(studyArea))
```

<img src="GG606_files/figure-html/unnamed-chunk-3-1.png" width="672" />

which we can now provide to a clip operation..


```r
trails_clip <- st_intersection(trails, studyArea)
```

```
## Warning: attribute variables are assumed to be spatially constant throughout all
## geometries
```

```r
#we can inspect the attributes to make sure 
names(trails)
```

```
##  [1] "OBJECTID"   "TrailType"  "TrailName"  "Streetname" "Municipali"
##  [6] "Settlement" "OwnedBy"    "Maintained" "OnOffRoad"  "SurfaceMat"
## [11] "Obstructio" "InstallDat" "Width_m"    "Length_m"   "Notes"     
## [16] "LifeStatus" "RMWID"      "CreatedUse" "CreatedDat" "LastEdited"
## [21] "LastEdit_1" "LucityAuto" "InLucity"   "LastSyncDa" "SegmentLuc"
## [26] "SHAPESTLen" "ContractNu" "Comments"   "geometry"
```

Examining these, we probably do not want to rely on `Length_m` in `trails_clip` since those lengths are going to refer to the length of the trial prior to us clipping them by the `ct` geometry. This is not a huge problem because we can extract geometric properties like length automatically from the geometry of the layer itself: 


```r
#always good to do some spot checking when wrangling
head(st_length(st_geometry(trails)))
```

```
## Units: [m]
## [1] 139.3061 378.1244 680.8490 450.6546 333.1547 495.0084
```

```r
head(trails$Length_m)
```

```
## [1] 139.3061 378.1244 680.8490 450.6546 333.1547 495.0084
```

```r
head(st_length(st_geometry(trails_clip)))
```

```
## Units: [m]
## [1] 139.3061 378.1244 680.8490 450.6546 333.1547 495.0084
```

```r
head(trails_clip$Length_m)
```

```
## [1] 139.3061 378.1244 680.8490 450.6546 333.1547 495.0084
```

Now we see we are getting identical results, but we have to remember only a few trails (i.e., those at the edges) are going to be affected by this issue. The safe thing to do would be do ignore `Length_m` in the table and just use the result of `st_length` in any analysis. BUT for the purposes of illustration let's explore where the discrepancy exists. We want to find rows in `trails_clip` have a different value for `Length_m` than the corresponding rows in `trails`. It is also possible that some entire features were clipped out - we can check this by simpling comparing the number of features/rows in each:


```r
nrow(trails)==nrow(trails_clip)
```

```
## [1] FALSE
```

Where we can see that in fact there are less features in `trails_clip`. If we look at how data are structured in the `trails` data we can learn more about how things are stored:


```r
head(trails)
```

```
## Simple feature collection with 6 features and 28 fields
## Geometry type: MULTILINESTRING
## Dimension:     XY
## Bounding box:  xmin: 536694.7 ymin: 4801974 xmax: 556613.6 ymax: 4814768
## Projected CRS: NAD83 / UTM zone 17N
##   OBJECTID TrailType                                              TrailName
## 1        1 Multi-Use                                                   <NA>
## 2        2 Multi-Use                 Trans Canada Trail \\ Iron Horse Trail
## 3        3 Multi-Use Trans Canada Trail \\ Iron Horse Trail \\ Laurel Trail
## 4        4 Multi-Use                                     Trans Canada Trail
## 5        5 Multi-Use                     Trans Canada Trail \\ Laurel Trail
## 6        6 Multi-Use                                     Trans Canada Trail
##         Streetname Municipali Settlement   OwnedBy Maintained OnOffRoad
## 1             <NA>  Cambridge  Cambridge Cambridge  Cambridge       Off
## 2             <NA>   Waterloo   Waterloo  Waterloo   Waterloo       Off
## 3             <NA>   Waterloo   Waterloo  Waterloo   Waterloo       Off
## 4 University Ave W   Waterloo   Waterloo  Waterloo   Waterloo       Off
## 5 University Ave W   Waterloo   Waterloo  Waterloo   Waterloo       Off
## 6             <NA>   Waterloo   Waterloo  Waterloo   Waterloo       Off
##    SurfaceMat Obstructio InstallDat Width_m Length_m
## 1     Asphalt       <NA>       <NA>       3 139.3061
## 2     Asphalt       <NA>       <NA>       3 378.1244
## 3     Asphalt       <NA>       <NA>       3 680.8490
## 4     Asphalt       <NA>       <NA>       3 450.6546
## 5     Asphalt       <NA>       <NA>       3 333.1547
## 6 Stone Chips       <NA>       <NA>       3 495.0084
##                                                                                        Notes
## 1 Tunnel under rail connecting Elgin St N; Dismount bike sign, PATHWAY, SHORT TERM 2008-2012
## 2                                                                                       <NA>
## 3                                                                               Laurel Trail
## 4                                                                                       <NA>
## 5                                                                               Laurel Trail
## 6                                                                                       <NA>
##   LifeStatus RMWID CreatedUse CreatedDat LastEdited LastEdit_1 LucityAuto
## 1 In Service  TRA1       <NA> 2011-08-25    RUCHRIS 2019-08-14        515
## 2 In Service  TRA2       <NA> 2011-09-01    RUCHRIS 2019-08-14        516
## 3 In Service  TRA3       <NA> 2011-09-01    RUCHRIS 2019-08-14        517
## 4 In Service  TRA4       <NA> 2011-09-01        RMW 2018-11-05        518
## 5 In Service  TRA5       <NA> 2011-09-01        RMW 2018-11-05        519
## 6 In Service  TRA6       <NA> 2011-09-01    RUCHRIS 2019-08-14        520
##   InLucity LastSyncDa SegmentLuc SHAPESTLen ContractNu Comments
## 1        1 2019-08-14         NA   139.3061       <NA>     <NA>
## 2        1 2019-08-14         NA   378.1244       <NA>     <NA>
## 3        1 2019-08-14         NA   680.8490       <NA>     <NA>
## 4        1 2018-11-05       8693   450.6546       <NA>     <NA>
## 5        1 2018-11-05       8693   333.1547       <NA>     <NA>
## 6        1 2019-08-14         NA   495.0084       <NA>     <NA>
##                         geometry
## 1 MULTILINESTRING ((556575.6 ...
## 2 MULTILINESTRING ((536694.7 ...
## 3 MULTILINESTRING ((536731.5 ...
## 4 MULTILINESTRING ((537060.2 ...
## 5 MULTILINESTRING ((537371.8 ...
## 6 MULTILINESTRING ((537627 48...
```

Looking at the `TrailName` column, we can see that this is actually fairly complex data. Each feature is not necessarily a complete trail, and even the same section of trail may have multiple names (e.g., the Iron Horse Trail is also considered part of the Trans Canada Trail). This model also ensures that the geometry is not duplicated in these sections, although it may make summarizing and some types of analysis more difficult. In order to answer our original question - which features in `trails` had lengths changed and as a result the values in `Length_m` in `trails_clip` are no longer accurate. To be safe, we can simple recompute the lengths using the `st_length` function


```r
trails_clip$Length_m <- st_length(trails_clip)
head(trails$Length_m)
```

```
## [1] 139.3061 378.1244 680.8490 450.6546 333.1547 495.0084
```

```r
head(trails_clip$Length_m)
```

```
## Units: [m]
## [1] 139.3061 378.1244 680.8490 450.6546 333.1547 495.0084
```

which we can see are equivalent, however notice that the output of the `st_length` function are aware of their units. This is dependent on the projection metadata and can be very useful. However,some functions may not know how to deal with data of this type (check `class(traisclip$Length_m`) in which case you can wrap it in `as.numeric` to convert to standard numeric vector data.

#### Measuring the length of lines within polygons
One thing we may want to do is calculate the total length of trails in each census tract. Now that we know that where we have overlapping trails (i.e., segments of more than one trail overlapping) that these are stored as a single linear feature not multiple, we can simply intersect the `trails_clip` data with the census tract and then summarize by census tract. 
#### Average attirbute value of point within polygons

#### Average value of a raster within polygons

#### Extract value of raster to points as new attribute

#### Downsample a raster

#### Interpolate a surface and average over polygons

#### Dissovle boundaries between adjacent polygons



#### Calcuate a point pattern kensity estimate

--->
</div>
</div>
<div id="temporal-data" class="section level2" number="2.6">
<h2><span class="header-section-number">2.6</span> Temporal data</h2>
<p>Temporal data wrangling - there are many many packages and classes available for handling temporal data and doing time series analysis. We will review some of the basic packages for reading and manipulating time-based data.</p>
<div id="space-time-data---stars-package-exploration" class="section level3" number="2.6.1">
<h3><span class="header-section-number">2.6.1</span> Space-time data - STARS package exploration</h3>
<p>Letâ€™s work thru some of the vignettes describing the relatively new <code>stars</code> package which combines functionality and classes for spatial and temporal data.</p>
<p><a href="https://r-spatial.github.io/stars/articles/stars1.html">View the vignette here</a></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="intro.html#cb1-1" aria-hidden="true"></a><span class="kw">library</span>(stars)</span></code></pre></div>
<pre><code>## Loading required package: abind</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="intro.html#cb3-1" aria-hidden="true"></a><span class="kw">methods</span>(<span class="dt">class =</span> <span class="st">&quot;stars&quot;</span>)</span></code></pre></div>
<pre><code>##  [1] [                 [[&lt;-              [&lt;-               %in%             
##  [5] $&lt;-               adrop             aggregate         aperm            
##  [9] as_tibble         as.data.frame     c                 coerce           
## [13] contour           cut               dim               dimnames         
## [17] dimnames&lt;-        droplevels        filter            hist             
## [21] image             initialize        is.na             Math             
## [25] merge             mutate            Ops               plot             
## [29] predict           print             pull              rename           
## [33] replace_na        select            show              slice            
## [37] slotsFromS3       split             st_apply          st_area          
## [41] st_as_sf          st_as_sfc         st_as_stars       st_bbox          
## [45] st_coordinates    st_crop           st_crs            st_crs&lt;-         
## [49] st_dimensions     st_dimensions&lt;-   st_downsample     st_extract       
## [53] st_geometry       st_interpolate_aw st_intersects     st_join          
## [57] st_mosaic         st_normalize      st_redimension    st_sample        
## [61] st_set_bbox       st_transform_proj st_transform      transmute        
## [65] write_stars      
## see &#39;?methods&#39; for accessing help and source code</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="intro.html#cb5-1" aria-hidden="true"></a>tif =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">&quot;tif/L7_ETMs.tif&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;stars&quot;</span>)</span>
<span id="cb5-2"><a href="intro.html#cb5-2" aria-hidden="true"></a>x =<span class="st"> </span><span class="kw">read_stars</span>(tif)</span>
<span id="cb5-3"><a href="intro.html#cb5-3" aria-hidden="true"></a><span class="kw">plot</span>(x, <span class="dt">axes =</span> <span class="ot">TRUE</span>)</span></code></pre></div>
<pre><code>## downsample set to 1</code></pre>
<p><img src="GG606_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="practice.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["GG606.pdf", "GG606.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
